[#]: subject: "NixOS Series #5: How to set up home-manager on NixOS?"
[#]: via: "https://itsfoss.com/home-manager-nixos/"
[#]: author: "Sagar Sharma https://itsfoss.com/author/sagar/"
[#]: collector: "lkxed"
[#]: translator: "wxy"
[#]: reviewer: "wxy"
[#]: publisher: "wxy"
[#]: url: "https://linux.cn/article-15697-1.html"

NixOS ç³»åˆ— #5ï¼šå¦‚ä½•åœ¨ NixOS ä¸Šè®¾ç½®å®¶åº­ç®¡ç†å‘˜ï¼Ÿ
======

åœ¨å‘è¡¨è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘è§£é‡Šäº†å¦‚ä½•ä¸ºä¸€ä¸ªå•ç”¨æˆ·ç³»ç»Ÿ [åœ¨ NixOS ä¸­å®‰è£…å’Œåˆ é™¤è½¯ä»¶åŒ…][1]ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨ä¾›å¤šä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ¥åˆ†åˆ«æ»¡è¶³æ¯ä¸ªç”¨æˆ·çš„éœ€æ±‚ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†æŒ‡å¯¼ä½ å¦‚ä½•åœ¨ NixOS ä¸Šè®¾ç½®ä¸€ä¸ªå®¶åº­ç®¡ç†å‘˜ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ¥å®‰è£…è½¯ä»¶åŒ…ã€‚

å¦‚æœä½ æ˜¯æ–°è¯»è€…ï¼Œæœ¬ç³»åˆ—ä¸­è®¨è®ºçš„ä¸€äº›èµ„æºåŒ…æ‹¬ï¼š

- [ä½¿ç”¨ NixOS çš„åŸå› ][2]
- [åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£… NixOS][3]
- [å®‰è£… NixOS åè¦åšçš„äº‹æƒ…][4]

### åœ¨ NixOS ä¸Šè®¾ç½®å®¶åº­ç®¡ç†å‘˜

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†æŒ‡å¯¼ä½ é€šè¿‡ 2 ç§æ–¹å¼æ¥è®¾ç½®å®¶åº­ç®¡ç†å‘˜ï¼š

- ç‹¬ç«‹çš„å®¶åº­ç®¡ç†å‘˜ï¼ˆä½¿ç”¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼‰
- ä½œä¸ºä¸€ä¸ª NixOS æ¨¡å—ï¼ˆåœ¨ `configuration.nix` æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒï¼‰

é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ä»ç‹¬ç«‹æ–¹å¼å¼€å§‹ã€‚

#### ç‹¬ç«‹å®‰è£…çš„å®¶åº­ç®¡ç†å‘˜

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ NixOS çš„ç¨³å®šé¢‘é“ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é…ç½®å®¶åº­ç®¡ç†å™¨ï¼š

```
nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager
```

åœ¨ç¼–å†™æœ¬æŒ‡å—æ—¶ï¼Œç¨³å®šç‰ˆæ˜¯ `22.11`ã€‚

è€Œ **å¦‚æœä½ åœ¨ä¸€ä¸ªä¸ç¨³å®šçš„é¢‘é“ä¸Š**ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```
nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
```

æ— è®ºä½ ä½¿ç”¨ç¨³å®šç‰ˆè¿˜æ˜¯ä¸ç¨³å®šç‰ˆï¼Œä¸‹é¢çš„æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚

ä¸€æ—¦å®Œæˆï¼Œæ›´æ–°é¢‘é“ï¼š

```
nix-channel --update
```

æœ€åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…å®¶åº­ç®¡ç†å‘˜ï¼š

```
nix-shell '<home-manager>' -A install
```

ğŸ› ï¸ åœ¨å®‰è£…æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

![å®‰è£…å®¶åº­ç®¡ç†å‘˜æ—¶å‡ºç°æ„å»ºé”™è¯¯][5]

é‡æ–°å¯åŠ¨ä½ çš„ç³»ç»Ÿå¹¶å†æ¬¡ä½¿ç”¨å®‰è£…å‘½ä»¤ï¼Œå®ƒå°†å¼€å§‹å®‰è£…ã€‚
 
ä¸€æ—¦å®Œæˆï¼Œå®ƒå°†æ˜¾ç¤ºç‹¬ç«‹å®‰è£…çš„å®¶åº­ç®¡ç†å‘˜çš„ä½ç½®ï¼š

![å®¶åº­ç®¡ç†å‘˜åœ¨NixOSä¸­çš„ä½ç½®][6]

#### å°†å®¶åº­ç®¡ç†å‘˜å®‰è£…ä¸º NixOS æ¨¡å—

> âš ï¸ å¦‚æœä½ é€‰æ‹©å°†å®¶åº­ç®¡ç†å‘˜ä½œä¸º NixOS æ¨¡å—ä½¿ç”¨ï¼Œä½ å°†éœ€è¦ sudo æƒé™ã€‚

å¦‚æœä½ åœ¨ä¸€ä¸ªç¨³å®šçš„é¢‘é“ä¸Šï¼ˆåœ¨å†™æœ¬æ–‡çš„æ—¶å€™ï¼Œæ˜¯ `22.11`ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ·»åŠ å®¶åº­ç®¡ç†å‘˜çš„ç¨³å®šé¢‘é“ï¼š

```
sudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-22.11.tar.gz home-manager
```

è€Œ **å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¸ç¨³å®šé€šé“æˆ–ä¸»é€šé“**ï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```
sudo nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
```

ä¸€æ—¦ä½ ä½¿ç”¨ä¸Šé¢çš„ä»»ä½•ä¸€æ¡å‘½ä»¤å®Œæˆäº†æ·»åŠ é¢‘é“çš„å·¥ä½œï¼Œå°±ç”¨ä¸‹é¢çš„æ–¹æ³•æ›´æ–°é¢‘é“ï¼š

```
sudo nix-channel --update
```

æ¥ä¸‹æ¥ï¼Œç”¨ä»¥ä¸‹æ–¹æ³•æ‰“å¼€ `configuration.nix` æ–‡ä»¶ï¼š

```
sudo nano /etc/nixos/configuration.nix
```

å¹¶åœ¨ `imports []` ä¸­æ·»åŠ ä»¥ä¸‹ä¸€è¡Œï¼š

```
<home-manager/nixos>
```

![å°†å®¶åº­ç®¡ç†å‘˜å®‰è£…ä¸º NixOS æ¨¡å—][7]

ç°åœ¨ï¼Œè·³åˆ°è¯¥è¡Œçš„æœ«å°¾ï¼Œåœ¨ `}` å‰æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```
home-manager.users.{username} = { pkgs, ... }: {
  home.packages = [ ] ;
  };
```

![NixOS é…ç½®æ–‡ä»¶ä¸­çš„å®¶åº­ç®¡ç†å‘˜æ¨¡å—çš„æ ¼å¼][8]

ä¸Šé¢è¿™ä¸€è¡Œæ˜¯ä¸ºäº†æ–¹ä¾¿å®‰è£…å’Œåˆ é™¤è½¯ä»¶åŒ…è€Œæ·»åŠ çš„ï¼Œæˆ‘æ¥ä¸‹æ¥ä¼šå‘Šè¯‰ä½ ã€‚

ç°åœ¨ï¼Œ[ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º Nano][9] æ–‡æœ¬ç¼–è¾‘å™¨ã€‚

æ¥ä¸‹æ¥ï¼Œé‡å»ºé…ç½®ï¼Œå¹¶åšä¸€ä¸ªåˆ‡æ¢ï¼š

```
sudo nixos-rebuild switch
```

ä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ç¨³å®šç‰ˆï¼Œå¹¶ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œå°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

> ğŸ› ï¸ é”™è¯¯ï¼š é€‰é¡¹ `home-manager.users.user.home.stateVersion` è¢«ä½¿ç”¨ä½†æ²¡æœ‰å®šä¹‰ï¼š

![é”™è¯¯ï¼š é€‰é¡¹ `home-manager.users.user.home.stateVersion` å·²è¢«ä½¿ç”¨ä½†æœªè¢«å®šä¹‰ã€‚][10]

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¿…é¡»åœ¨ä½ çš„å®¶åº­ç®¡ç†å™¨å—ä¸­æ·»åŠ  `home.stateVersion`ã€‚

åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œæˆ‘æ­£åœ¨è¿è¡Œ 22.11ï¼Œæ‰€ä»¥æ•´ä¸ªå®¶åº­ç®¡ç†å‘˜å—çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```
home-manager.users.{username} = { pkgs, ... }: {
  home.stateVersion = "22.11";  
  home.packages = [ ] ;
  };
```

![å¦‚ä½•è§£å†³ `home-manager.users.user.home.stateVersion` é€‰é¡¹è¢«ä½¿ç”¨ä½†æ²¡æœ‰å®šä¹‰ã€‚][11]

ä¿å­˜ä¿®æ”¹ï¼ŒæŒ‰ `Ctrl+O`ï¼ŒæŒ‰å›è½¦é”®å’Œ `Ctrl+X` é€€å‡º Nano æ–‡æœ¬ç¼–è¾‘å™¨ã€‚

ç°åœ¨ï¼Œè¯•ç€é‡å»ºé…ç½®å¹¶å†æ¬¡è¿›è¡Œåˆ‡æ¢ï¼Œåº”è¯¥å¯ä»¥è§£å†³é—®é¢˜ã€‚

### å¦‚ä½•åœ¨ NixOS ä¸Šä½¿ç”¨å®¶åº­ç®¡ç†å‘˜å®‰è£…è½¯ä»¶åŒ…

ç°åœ¨ä½ å·²ç»å®‰è£…äº†å®¶åº­ç®¡ç†å‘˜ï¼Œå¦‚ä½•ç”¨å®ƒæ¥å®‰è£…è½¯ä»¶åŒ…ï¼š

#### ä½¿ç”¨ç‹¬ç«‹å®‰è£…çš„å®¶åº­ç®¡ç†å‘˜

é¦–å…ˆï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š

```
nano /home/$USER/.config/nixpkgs/home.nix
```

è·³åˆ°è¡Œæœ«ï¼Œåœ¨ `}` å‰æ·»åŠ ä»¥ä¸‹ä»£ç å—ï¼š

```
home.packages = [];
```

ç°åœ¨ï¼Œä½ æ‰€è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸¤ä¸ªå¤§æ‹¬å·ä¹‹é—´å†™ä¸Šè½¯ä»¶åŒ…çš„åç§°ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘æƒ³å®‰è£… `htop`ï¼Œæˆ‘å°†å¾—è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```
home.packages = [pkgs.htop];
```

æ˜¯çš„ï¼Œä½ é€šå¸¸è¦åœ¨è½¯ä»¶åŒ…çš„åç§°åé¢åŠ ä¸Š `pkgs.`ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³åœ¨æ¯æ¬¡å®‰è£…æ–°åŒ…æ—¶ä¸ä½¿ç”¨ `pkgs.`ï¼Œå¯ä»¥æ”¹å˜ä»£ç å—çš„è¯­æ³•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

```
home.packages = with pkgs; [];
```

è€Œç°åœ¨ï¼Œä½ ä¸å†éœ€è¦åœ¨æ¯æ¬¡å®‰è£…æ—¶ä½¿ç”¨ `pkgs.`ï¼š

```
home.packages = with pkgs; [htop];
```

ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å®‰è£… `htop`ã€`firefox`å’Œ `libreoffice`ï¼Œæ‰€ä»¥æˆ‘çš„ `home` å—ä¼šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

![åœ¨ NixOS ä¸Šä½¿ç”¨å®¶åº­ç®¡ç†å‘˜å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…][12]

ä¸€æ—¦ä½ å®Œæˆäº†æ·»åŠ ä½ å–œæ¬¢çš„è½¯ä»¶åŒ…ï¼Œä¿å­˜é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…è½¯ä»¶åŒ…ï¼š

```
home-manager switch
```

#### ä½¿ç”¨ NixOS æ¨¡å—æ–¹å¼

é¦–å…ˆï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ `configuration.nix` æ–‡ä»¶ï¼š

```
sudo nano /etc/nixos/configuration.nix
```

åœ¨é…ç½®éƒ¨åˆ†ï¼Œæˆ‘å·²ç»æ·»åŠ äº†å®¶åº­ç®¡ç†å‘˜å—ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯åœ¨ `home.packages = [ ];` é‡Œé¢æ·»åŠ è½¯ä»¶åŒ…çš„åç§°ï¼Œæ ¼å¼å¦‚å›¾æ‰€ç¤ºï¼š

```
home.packages = [ pkgs.package_name ] ;
```

> ğŸ’¡æˆ‘å·²ç»åœ¨ä¸ŠèŠ‚æåˆ°è½¯ä»¶åŒ…åç§°å‰ä½ å¯ä»¥ä½¿ç”¨ `pkgs.` ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘æƒ³ [å®‰è£… htop][13]ã€Firefox å’Œ LibreOfficeï¼Œé‚£ä¹ˆæˆ‘å°†æ·»åŠ ï¼š

```
pkgs.htop pkgs.firefox pkgs.libreoffice
```

ç„¶åæˆ‘çš„å®¶åº­ç®¡ç†å‘˜å—ä¼šçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

![ä½œä¸º NixOS æ¨¡å—åœ¨å®¶åº­ç®¡ç†å‘˜ä¸­å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…][14]

ç°åœ¨ï¼Œä¿å­˜ä¿®æ”¹å¹¶é€€å‡ºæ–‡æœ¬ç¼–è¾‘å™¨ã€‚

æ¥ä¸‹æ¥ï¼Œé‡å»ºé…ç½®å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œåˆ‡æ¢ï¼š

```
sudo nixos-rebuild switch
```

è¿™æ˜¯è¿™æ ·ï¼è½¯ä»¶åŒ…å°†å¾ˆå¿«è¢«å®‰è£…ã€‚

### è¿™å°±ç»“æŸäº†

æˆ‘è®¤ä¸ºä½ åº”è¯¥é€‰æ‹©ç‹¬ç«‹å®‰è£…ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä½¿ç”¨è¶…çº§ç”¨æˆ·çš„æƒé™ã€‚å¦å¤–ï¼Œå¦‚æœä½ è¿è¡Œä¸€ä¸ªæœ‰å¤šä¸ªç”¨æˆ·çš„ç³»ç»Ÿï¼Œä¸ºä¸åŒçš„ç”¨æˆ·æ‹¥æœ‰ä¸åŒçš„é…ç½®æ–‡ä»¶æ˜¯ç›¸å½“æ–¹ä¾¿çš„ã€‚

å› æ­¤ï¼Œé™¤éä½ æƒ³ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥å®ç°å„ç§ç›®çš„ï¼Œå¦åˆ™æˆ‘è®¤ä¸ºæ²¡æœ‰å…¶ä»–ç†ç”±ä½¿ç”¨æ¨¡å—é€‰é¡¹ã€‚

å°±è¿™æ ·ï¼Œæˆ‘ç»“æŸäº† NixOS çš„åˆå­¦è€…ç³»åˆ—ã€‚æˆ‘å¸Œæœ›å®ƒèƒ½ç»™ä½ ä¸€ä¸ªè¶³å¤Ÿå¥½çš„å¹³å°æ¥ç†Ÿæ‚‰è¿™ä¸ªç‹¬ç‰¹çš„ Linux å‘è¡Œç‰ˆã€‚

ğŸ’¬ ä½ å–œæ¬¢ NixOS ç³»åˆ—æ–‡ç« å—ï¼Ÿå¯¹äº NixOS çš„åˆå­¦è€…ï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆè¦ä»‹ç»çš„å—ï¼Ÿè¯·æä¾›ä½ çš„å®è´µæ„è§ã€‚

--------------------------------------------------------------------------------

via: https://itsfoss.com/home-manager-nixos/

ä½œè€…ï¼š[Sagar Sharma][a]
é€‰é¢˜ï¼š[lkxed][b]
è¯‘è€…ï¼š[wxy](https://github.com/wxy)
æ ¡å¯¹ï¼š[wxy](https://github.com/wxy)

æœ¬æ–‡ç”± [LCTT](https://github.com/LCTT/TranslateProject) åŸåˆ›ç¼–è¯‘ï¼Œ[Linuxä¸­å›½](https://linux.cn/) è£èª‰æ¨å‡º

[a]: https://itsfoss.com/author/sagar/
[b]: https://github.com/lkxed/
[1]: https://linux.cn/article-15645-1.html
[2]: https://linux.cn/article-15606-1.html
[3]: https://linux.cn/article-15624-1.html
[4]: https://linux.cn/article-15663-1.html
[5]: https://itsfoss.com/content/images/2023/02/building-error-while-installing-home-manager.png
[6]: https://itsfoss.com/content/images/2023/02/location-of-home-manager-in-NixOS.png
[7]: https://itsfoss.com/content/images/2023/02/install-home-manager-as-NixOS-module.png
[8]: https://itsfoss.com/content/images/2023/02/syantax-for-home-manager-module-in-NixOS-config-file.png
[9]: https://linuxhandbook.com/nano-save-exit/?ref=itsfoss.com
[10]: https://itsfoss.com/content/images/2023/02/The-option--home-manager.users.user.home.stateVersion--is-used-but-not-defined..png
[11]: https://itsfoss.com/content/images/2023/02/how-to-solve-The-option--home-manager.users.user.home.stateVersion--is-used-but-not-defined..png
[12]: https://itsfoss.com/content/images/2023/02/install-multiple-packages-using-home-manager-on-NixOS.png
[13]: https://itsfoss.com/use-htop/
[14]: https://itsfoss.com/content/images/2023/02/install-multiple-packages-in-home-manager-as-a-NixOS-module.png
[0]: https://img.linux.net.cn/data/attachment/album/202304/06/110641k8v9q1152hhhh114.jpg