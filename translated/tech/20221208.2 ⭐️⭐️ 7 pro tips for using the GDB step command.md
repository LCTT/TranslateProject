[#]: subject: "7 pro tips for using the GDB step command"
[#]: via: "https://opensource.com/article/22/12/gdb-step-command"
[#]: author: "Alexandra https://opensource.com/users/ahajkova"
[#]: collector: "lkxed"
[#]: translator: "chai001125"
[#]: reviewer: " "
[#]: publisher: " "
[#]: url: " "

GDB è¿›å…¥å‡½æ•°å†…éƒ¨çš„ 7 ä¸ªå‘½ä»¤
======

>**è°ƒè¯•å™¨**æ˜¯ä¸€ä¸ªå¯ä»¥è¿è¡Œä½ çš„ä»£ç å¹¶æ£€æŸ¥é—®é¢˜çš„è½¯ä»¶ã€‚[GNU Debugger][1]ï¼ˆGBDï¼‰æ˜¯æœ€æµè¡Œçš„è°ƒè¯•å™¨ä¹‹ä¸€ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç ”ç©¶äº† **GDB è¿›å…¥å‡½æ•°å†…éƒ¨çš„å‡ ä¸ªå‘½ä»¤**ï¼ŒåŒ…å«äº† **`step` å‘½ä»¤**å’Œå…¶ä»–å‡ ä¸ª**å¸¸è§çš„ GDB å‘½ä»¤**ã€‚`step` æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒæœ‰ä¸€äº›äººä»¬ä¸å¤ªäº†è§£çš„åœ°æ–¹ï¼Œå¯èƒ½ä¼šä½¿å¾—ä»–ä»¬ååˆ†å›°æƒ‘ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥**åœ¨ä¸ä½¿ç”¨ `step` å‘½ä»¤çš„æƒ…å†µä¸‹è¿›å…¥ä¸€ä¸ªå‡½æ•°**ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸å¤ªçŸ¥åçš„ `advance` å‘½ä»¤ã€‚

### 1ã€æ— è°ƒè¯•ç¬¦å·

è€ƒè™‘ä»¥ä¸‹è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ç¨‹åºï¼š

```
#include <stdio.h>

int num() {
    return 2;
}

void bar(int i) {
    printf("i = %d\n", i);
}

int main() {
    bar(num());
    return 0;
}
```

å¦‚æœä½ åœ¨æ²¡æœ‰ <ruby>è°ƒè¯•ç¬¦å·<rt> debugging sysbols </rt></ruby> çš„æƒ…å†µä¸‹è¿›è¡Œç¼–è¯‘ï¼ˆå³åœ¨ä½¿ç”¨ `gcc` ç¼–è¯‘ç¨‹åºæ—¶ä¸Šï¼Œæ²¡æœ‰å†™ `-g` é€‰é¡¹ï¼‰ï¼Œç„¶ååœ¨ `bar` ä¸Šè®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åå°è¯•åœ¨è¿™ä¸ªå‡½æ•°å†…ä½¿ç”¨ `step`ï¼Œæ¥å•æ­¥æ‰§è¡Œè¯­å¥ã€‚GDB ä¼šç»™å‡ºä¸€ä¸ª <ruby>æ²¡æœ‰è¡Œå·ä¿¡æ¯<rt> no line number information </rt></ruby> çš„é”™è¯¯ä¿¡æ¯ã€‚

```
gcc exmp.c -o exmp
gdb ./exmp
(gdb) b bar
Breakpoint 1 at 0x401135
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, 0x0000000000401135 in bar ()
(gdb) step
Single stepping until exit from function bar,
which has no line number information.
i = 2
0x0000000000401168 in main ()
```

### 2ã€`stepi` å‘½ä»¤

ä½†æ˜¯ä½ ä»ç„¶å¯ä»¥åœ¨æ²¡æœ‰è¡Œå·ä¿¡æ¯çš„å‡½æ•°å†…éƒ¨å•æ­¥æ‰§è¡Œè¯­å¥ï¼Œä½†è¦ä½¿ç”¨ `stepi` å‘½ä»¤æ¥ä»£æ›¿ `step`ã€‚`stepi` ä¸€æ¬¡åªæ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚å½“ä½¿ç”¨ GDB çš„ `stepi` å‘½ä»¤æ—¶ï¼Œå…ˆåš `display/i $pc` é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œè¿™ä¼šåœ¨æ¯ä¸€æ­¥ä¹‹å**æ˜¾ç¤º** <ruby>**ç¨‹åºè®¡æ•°å™¨çš„å€¼**<rt> program counter value </rt></ruby> å’Œ**ç›¸åº”çš„** <ruby>**æœºå™¨æŒ‡ä»¤**<rt> machine instruction </rt></ruby>ï¼š

```
(gdb) b bar
Breakpoint 1 at 0x401135
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, 0x0000000000401135 in bar ()
(gdb) display/i $pc
1: x/i $pc
=> 0x401135 <bar+4>: sub $0x10,%rsp
```

åœ¨ä¸Šè¿°çš„ `display` å‘½ä»¤ä¸­ï¼Œ`i` ä»£è¡¨æœºå™¨æŒ‡ä»¤ï¼Œ`$pc` è¡¨ç¤ºç¨‹åºè®¡æ•°å™¨å¯„å­˜å™¨ï¼ˆå³ PC å¯„å­˜å™¨ï¼‰ã€‚

ä½¿ç”¨ `info registers` å‘½ä»¤ï¼Œæ¥**æ‰“å°å¯„å­˜å™¨çš„å†…å®¹**ï¼Œä¹Ÿæ˜¯ååˆ†æœ‰ç”¨çš„ã€‚

```
(gdb) info registers
rax 0x2 2
rbx 0x7fffffffdbc8 140737488346056
rcx 0x403e18 4210200
(gdb) print $rax
$1 = 2
(gdb) stepi
0x0000000000401139 in bar ()
1: x/i $pc
=> 0x401139 <bar+8>: mov %edi,-0x4(%rbp)
```

### 3ã€å¤æ‚çš„å‡½æ•°è°ƒç”¨

åœ¨å¸¦è°ƒè¯•ç¬¦å·çš„ `-g` é€‰é¡¹ï¼Œé‡æ–°ç¼–è¯‘ç¤ºä¾‹ç¨‹åºåï¼Œä½ å¯ä»¥ç”¨ `main` ä¸­çš„è¡Œå·ï¼Œåœ¨ `bar` ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œç„¶åå†å•æ­¥æ‰§è¡Œ `bar` å‡½æ•°çš„è¯­å¥ï¼š

```
gcc -g exmp.c -o exmp
gdb ./exmp
(gdb) b exmp.c:14
Breakpoint 1 at 0x401157: file exmp.c, line 14.
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, main () at exmp.c:14
14 bar(num());
```

æ¥ä¸‹æ¥ï¼Œç”¨ `step`ï¼Œæ¥å•æ­¥æ‰§è¡Œ `bar()` å‡½æ•°çš„è¯­å¥ï¼š

```
(gdb) step
num () at exmp.c:4
4 return 2;
```

å‡½æ•°è°ƒç”¨çš„å‚æ•°éœ€è¦åœ¨å®é™…çš„å‡½æ•°è°ƒç”¨ä¹‹å‰è¿›è¡Œå¤„ç†ï¼Œ`bar()` å‡½æ•°è°ƒç”¨äº† `num()` å‡½æ•°ï¼Œæ‰€ä»¥ `num()` ä¼šåœ¨ `bar()` è¢«è°ƒç”¨ä¹‹å‰æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œé€šè¿‡ GDB è°ƒè¯•ï¼Œä½ æ€ä¹ˆæ‰èƒ½å¦‚æ„¿ä»¥å¿åœ°è¿›å…¥ `bar()` å‡½æ•°å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ `finish` å‘½ä»¤ï¼Œå¹¶å†æ¬¡ä½¿ç”¨ `step` å‘½ä»¤ã€‚

```
(gdb) finish
Run till exit from #0 num () at exmp.c:4
0x0000000000401161 in main () at exmp.c:14
14 bar(num());
Value returned is $1 = 2
(gdb) step
bar (i=2) at exmp.c:9
9 printf("i = %d\n", i);
```

### 4ã€`Tbreak` å‘½ä»¤

`tbreak` å‘½ä»¤ä¼šè®¾ç½®ä¸€ä¸ª**ä¸´æ—¶æ–­ç‚¹**ã€‚å¦‚æœä½ ä¸æƒ³è®¾ç½®æ°¸ä¹…æ–­ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼Œä½ æƒ³è¿›å…¥ä¸€ä¸ªå¤æ‚çš„å‡½æ•°è°ƒç”¨ï¼Œä¾‹å¦‚ `f(g(h()), i(j()), ...)`ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä¸€ä¸ªå¾ˆé•¿çš„ `step/finish/step` åºåˆ—ï¼Œæ‰èƒ½åˆ°è¾¾ `f` å‡½æ•°ã€‚å¦‚æœä½ è®¾ç½®ä¸€ä¸ªä¸´æ—¶æ–­ç‚¹ï¼Œç„¶åå†ä½¿ç”¨ `continue` å‘½ä»¤ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»¥ä¸Šçš„åºåˆ—äº†ã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦åƒä»¥å‰ä¸€æ ·å°†æ–­ç‚¹è®¾ç½®åœ¨ `main` çš„ `bar` è°ƒç”¨ä¸Šã€‚ç„¶ååœ¨ `bar` ä¸Šè®¾ç½®ä¸´æ—¶æ–­ç‚¹ã€‚å½“åˆ°è¾¾è¯¥ä¸´æ—¶æ–­ç‚¹åï¼Œä¸´æ—¶æ–­ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚


```
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, main () at exmp.c:14
14 bar(num());
(gdb) tbreak bar
Temporary breakpoint 2 at 0x40113c: file exmp.c, line 9.
```

åœ¨è°ƒç”¨ `bar` çš„æ—¶å€™é‡åˆ°æ–­ç‚¹ï¼Œå¹¶åœ¨ `bar` ä¸Šè®¾ç½®ä¸´æ—¶æ–­ç‚¹åï¼Œä½ åªéœ€è¦ä½¿ç”¨`continue` ç»§ç»­è¿è¡Œç›´åˆ° `bar` ç»“æŸã€‚

```
(gdb) continue
Continuing.
Temporary breakpoint 2, bar (i=2) at exmp.c:9
9 printf("i = %d\n", i);
```

### 5ã€`disable` å‘½ä»¤

ç±»ä¼¼åœ°ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ `bar` ä¸Šè®¾ç½®ä¸€ä¸ªæ­£å¸¸çš„æ–­ç‚¹ï¼Œç„¶åæ‰§è¡Œ `continue`ï¼Œç„¶ååœ¨ä¸å†éœ€è¦ç¬¬äºŒä¸ªæ–­ç‚¹æ—¶ï¼Œä½¿ç”¨`disable` å‘½ä»¤ç¦ç”¨è¿™ä¸ªæ–­ç‚¹ï¼Œè¿™æ ·ä¹Ÿèƒ½è¾¾åˆ°ä¸ `tbreak` ç›¸åŒçš„æ•ˆæœã€‚

```
(gdb) b exmp.c:14
Breakpoint 1 at 0x401157: file exmp.c, line 14.
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, main () at exmp.c:14
14 bar(num());
(gdb) b bar
Breakpoint 2 at 0x40113c: file exmp.c, line 9.
(gdb) c
Continuing.
Breakpoint 2, bar (i=2) at exmp.c:9
9 printf("i = %d\n", i);
(gdb) disable 2
```

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ`info breakpoints` å‘½ä»¤åœ¨ `Enb` ä¸‹æ˜¾ç¤ºä¸º `n`ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªæ–­ç‚¹å·²è¢«ç¦ç”¨ã€‚ä½†ä½ ä¹Ÿèƒ½åœ¨å†æ¬¡éœ€è¦è¿™ä¸ªæ–­ç‚¹æ—¶ï¼Œå†å¯ç”¨å®ƒã€‚

```
(gdb) info breakpoints
Num Type Disp Enb Address What
1 breakpoint keep y 0x0000000000401157 in main at exmp.c:14
breakpoint already hit 1 time
2 breakpoint keep n 0x000000000040113c in bar at exmp.c:9
breakpoint already hit 1 time
(gdb) enable 2
(gdb) info breakpoints
Num Type Disp Enb Address What
1 breakpoint keep y 0x000000000040116a in main at exmp.c:19
breakpoint already hit 1 time
2 breakpoint keep y 0x0000000000401158 in bar at exmp.c:14
breakpoint already hit 1 time
```

### 6ã€`Advance` å‘½ä»¤è¿è¡Œç¨‹åºåˆ°æŒ‡å®šçš„ä½ç½®

å¦ä¸€ä¸ªè¿›å…¥å‡½æ•°å†…éƒ¨çš„æ–¹æ³•æ˜¯ `advance` å‘½ä»¤ã€‚ä½ å¯ä»¥ç®€å•åœ°ç”¨ `advance bar`ï¼Œæ¥ä»£æ›¿ `tbreak bar ; continue`ã€‚è¿™ä¸€å‘½ä»¤ä¼šå°†ç¨‹åºç»§ç»­è¿è¡Œåˆ°æŒ‡å®šçš„ä½ç½®ã€‚

`advance` å‘½ä»¤çš„ä¸€ä¸ªå¾ˆæ£’çš„åœ°æ–¹åœ¨äºï¼šå¦‚æœç¨‹åºå¹¶æ²¡æœ‰åˆ°è¾¾ä½ è¯•å›¾è¿›å…¥çš„ä½ç½®ï¼Œé‚£ä¹ˆ GDB å°†åœ¨å½“å‰å‡½æ•°è¿è¡Œå®Œæˆååœæ­¢ã€‚å› æ­¤ï¼Œç¨‹åºçš„æ‰§è¡Œä¼šå—åˆ°é™åˆ¶ï¼š

```
Breakpoint 1 at 0x401157: file exmp.c, line 14.
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, main () at exmp.c:14
14 bar(num());
(gdb) advance bar
bar (i=2) at exmp.c:9
9 printf("i = %d\n", i);
```

### 7ã€`skip` å‘½ä»¤

è¿›å…¥ `bar` å‡½æ•°çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ `skip num` å‘½ä»¤ï¼š

```
(gdb) b exmp.c:14
Breakpoint 1 at 0x401157: file exmp.c, line 14.
(gdb) skip num
Function num will be skipped when stepping.
(gdb) r
Starting program: /home/ahajkova/exmp
Breakpoint 1, main () at exmp.c:14
14 bar(num());
(gdb) step
bar (i=2) at exmp.c:9
9 printf("i = %d\n", i);
```

è¯·ä½¿ç”¨ `info skip` å‘½ä»¤ï¼Œæ¥äº†è§£ GDB è·³è¿‡äº†å“ªäº›å‡½æ•°ã€‚`num()` å‡½æ•°è¢«æ ‡è®°ä¸º `y`ï¼Œè¡¨ç¤ºè·³è¿‡äº† `num()` å‡½æ•°ï¼š

```
(gdb) info skip
Num Enb Glob File RE Function
1 y n <none> n num
```

å¦‚æœä¸å†éœ€è¦ `skip`ï¼Œå¯ä»¥ç¦ç”¨ï¼ˆç¨åé‡æ–°å¯ç”¨ï¼‰æˆ–å®Œå…¨åˆ é™¤å®ƒã€‚ä½ å¯ä»¥æ·»åŠ å¦ä¸€ä¸ª `skip`ï¼Œå¹¶ç¦ç”¨ç¬¬ä¸€ä¸ª `skip`ï¼Œç„¶åå…¨éƒ¨åˆ é™¤ã€‚è¦ç¦ç”¨æŸä¸ª `skip`ï¼Œå¿…é¡»æŒ‡å®šå…¶ç¼–å·ï¼ˆä¾‹å¦‚ï¼Œ`skip disable 1`ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šç¦ç”¨æ‰€æœ‰çš„ `skip`ã€‚å¯ç”¨æˆ–åˆ é™¤ `skip` çš„å·¥ä½œåŸç†ç›¸åŒï¼š

```
(gdb) skip bar
(gdb) skip disable 1
(gdb) info skip
Num Enb Glob File RE Function
1 n n <none> n num
2 y n <none> n bar
(gdb) skip delete
(gdb) info skip
Not skipping any files or functions.
```

### GDB çš„ `step` å‘½ä»¤

ä½¿ç”¨ GDB çš„ `step` å‘½ä»¤æ˜¯è°ƒè¯•ç¨‹åºçš„ä¸€ä¸ªæœ‰ç”¨å·¥å…·ã€‚å³ä½¿æ˜¯å¤æ‚çš„å‡½æ•°ï¼Œä¹Ÿæœ‰å‡ ç§æ–¹æ³•å¯ä»¥è¿›å…¥è¿™äº›å‡½æ•°ï¼Œæ‰€ä»¥ä¸‹æ¬¡ä½ åœ¨æ’é™¤ä»£ç é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹è¿™äº› GDB æŠ€æœ¯ã€‚

--------------------------------------------------------------------------------

via: https://opensource.com/article/22/12/gdb-step-command

ä½œè€…ï¼š[Alexandra][a]
é€‰é¢˜ï¼š[lkxed][b]
è¯‘è€…ï¼š[chai001125](https://github.com/chai001125)
æ ¡å¯¹ï¼š[æ ¡å¯¹è€…ID](https://github.com/æ ¡å¯¹è€…ID)

æœ¬æ–‡ç”± [LCTT](https://github.com/LCTT/TranslateProject) åŸåˆ›ç¼–è¯‘ï¼Œ[Linuxä¸­å›½](https://linux.cn/) è£èª‰æ¨å‡º

[a]: https://opensource.com/users/ahajkova
[b]: https://github.com/lkxed
[1]: https://opensource.com/article/21/3/debug-code-gdb
